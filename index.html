<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CFTE Desktop OS</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <!-- Google Fonts: Inter & Roboto Mono -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        cfte: {
                            pink: '#E6007E', // Signature CFTE Pink
                            black: '#000000',
                            surface: '#121212',
                            border: '#333333',
                            text: '#EDEDED'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['Roboto Mono', 'monospace'],
                    },
                    animation: {
                        'pop-in': 'popIn 0.2s ease-out forwards',
                        'fade-in': 'fadeIn 0.3s ease-out forwards',
                    },
                    keyframes: {
                        popIn: {
                            '0%': { transform: 'scale(0.9)', opacity: '0' },
                            '100%': { transform: 'scale(1)', opacity: '1' },
                        },
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            overflow: hidden;
            background-color: #000000;
            background-image: 
                radial-gradient(circle at 50% 0%, rgba(230, 0, 126, 0.15), transparent 40%),
                radial-gradient(circle at 0% 100%, rgba(20, 20, 20, 1), transparent 30%);
            user-select: none;
            color: #EDEDED;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #000000;
        }
        ::-webkit-scrollbar-thumb {
            background: #333333;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #E6007E;
        }

        /* Updated Glass/Surface Utility - Darker for True Black feel */
        .glass {
            background: rgba(18, 18, 18, 0.85);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 0 1px #000000; /* Sharp inner shadow */
        }

        .window-shadow {
            box-shadow: 0 40px 80px -20px rgba(0, 0, 0, 0.9);
        }

        .app-icon:hover {
            transform: translateY(-5px);
            filter: drop-shadow(0 0 15px rgba(230, 0, 126, 0.4));
        }
    </style>
</head>
<body class="text-cfte-text font-sans h-screen w-screen relative overflow-hidden">

    <!-- Restart Button -->
    <button onclick="location.reload()" class="absolute top-6 right-6 z-50 bg-white/10 hover:bg-red-500/80 text-white px-4 py-2 rounded-lg backdrop-blur-md border border-white/10 transition-colors flex items-center gap-2 shadow-lg group">
        <i class="ph-bold ph-power group-hover:rotate-180 transition-transform duration-500"></i>
        <span class="text-sm font-medium">Restart System</span>
    </button>

    <!-- Centered Background Logo - Reduced size by half (w-96 -> w-48) -->
    <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 pointer-events-none z-0">
        <img src="https://courses.cfte.education/wp-content/uploads/2024/09/act-cfte-logo-transparent-white-e1737471820731.png" alt="CFTE Logo" class="w-48">
    </div>

    <!-- Desktop Icons Area -->
    <div id="desktop" class="absolute top-0 left-0 w-full h-[calc(100%-3rem)] p-6 grid grid-cols-1 gap-6 content-start sm:flex sm:flex-col sm:flex-wrap sm:content-start z-0">
        <!-- Icons injected by JS -->
    </div>

    <!-- Windows Container -->
    <div id="window-container" class="absolute inset-0 pointer-events-none z-10">
        <!-- Windows injected by JS -->
    </div>

    <!-- Taskbar -->
    <div class="absolute bottom-0 w-full h-12 glass z-50 flex items-center justify-between px-4 select-none border-t border-cfte-border bg-[#050505]/90">
        
        <!-- Start / System Menu -->
        <div class="flex items-center gap-4">
            <button id="start-btn" class="text-cfte-pink hover:bg-white/10 p-2 rounded transition-colors group relative">
                <i class="ph-bold ph-circles-four text-2xl group-hover:rotate-90 transition-transform duration-300"></i>
            </button>
            
            <!-- Opened Apps Tray -->
            <div id="taskbar-apps" class="flex items-center gap-2 h-full pl-2 border-l border-cfte-border">
                <!-- App pills injected here -->
            </div>
        </div>

        <!-- System Tray -->
        <div class="flex items-center gap-4 text-sm text-gray-500">
            <div class="hover:text-white cursor-pointer"><i class="ph-bold ph-wifi-high"></i></div>
            <div class="hover:text-white cursor-pointer"><i class="ph-bold ph-speaker-high"></i></div>
            <div class="hover:text-white cursor-pointer flex items-center gap-2 px-2 py-1 rounded hover:bg-white/5 transition-colors">
                <span id="clock-time" class="text-gray-300">12:00</span>
                <span id="clock-date" class="hidden sm:inline text-xs text-gray-600">Dec 10</span>
            </div>
        </div>
    </div>

    <!-- Start Menu (Hidden by default) -->
    <div id="start-menu" class="hidden absolute bottom-14 left-4 w-80 glass rounded-lg window-shadow flex flex-col p-4 z-50 animate-pop-in bg-[#121212]">
        <div class="flex items-center gap-3 mb-4 pb-4 border-b border-cfte-border">
            <div class="w-10 h-10 rounded-full bg-gradient-to-br from-cfte-pink to-purple-800 flex items-center justify-center text-white font-bold border border-white/10">
                CF
            </div>
            <div>
                <div class="font-semibold text-white">Guest User</div>
                <div class="text-xs text-cfte-pink">CFTE Professional</div>
            </div>
        </div>
        <div class="grid grid-cols-4 gap-2 mb-4">
            <!-- Quick Actions -->
            <button class="flex flex-col items-center justify-center p-2 hover:bg-white/5 rounded transition-colors group" onclick="os.openApp('terminal')">
                <i class="ph-duotone ph-terminal-window text-2xl text-green-500 mb-1 group-hover:text-green-400"></i>
                <span class="text-[10px] text-gray-400 group-hover:text-white">Term</span>
            </button>
            <button class="flex flex-col items-center justify-center p-2 hover:bg-white/5 rounded transition-colors group" onclick="os.openApp('learnflix')">
                <i class="ph-duotone ph-monitor-play text-2xl text-red-600 mb-1 group-hover:text-red-500"></i>
                <span class="text-[10px] text-gray-400 group-hover:text-white">LearnFlix</span>
            </button>
            <button class="flex flex-col items-center justify-center p-2 hover:bg-white/5 rounded transition-colors group" onclick="os.openApp('personaltutor')">
                <i class="ph-duotone ph-chats-circle text-2xl text-purple-500 mb-1 group-hover:text-purple-400"></i>
                <span class="text-[10px] text-gray-400 group-hover:text-white">Tutor</span>
            </button>
            <button class="flex flex-col items-center justify-center p-2 hover:bg-white/5 rounded transition-colors group" onclick="os.openApp('interactivepodcast')">
                <i class="ph-duotone ph-broadcast text-2xl text-orange-500 mb-1 group-hover:text-orange-400"></i>
                <span class="text-[10px] text-gray-400 group-hover:text-white">Podcast</span>
            </button>
            <button class="flex flex-col items-center justify-center p-2 hover:bg-white/5 rounded transition-colors group" onclick="os.openApp('dailymessenger')">
                <i class="ph-duotone ph-chat-centered-text text-2xl text-teal-500 mb-1 group-hover:text-teal-400"></i>
                <span class="text-[10px] text-gray-400 group-hover:text-white">Daily</span>
            </button>
            <button class="flex flex-col items-center justify-center p-2 hover:bg-white/5 rounded transition-colors group" onclick="os.openApp('future')">
                <i class="ph-duotone ph-lightbulb text-2xl text-cyan-500 mb-1 group-hover:text-cyan-400"></i>
                <span class="text-[10px] text-gray-400 group-hover:text-white">About</span>
            </button>
            <!-- Added Experiential Learning Button -->
            <button class="flex flex-col items-center justify-center p-2 hover:bg-white/5 rounded transition-colors group" onclick="os.openApp('experiential')">
                <i class="ph-duotone ph-flask text-2xl text-blue-500 mb-1 group-hover:text-blue-400"></i>
                <span class="text-[10px] text-gray-400 group-hover:text-white">Projects</span>
            </button>
            <!-- Added Video Button -->
            <button class="flex flex-col items-center justify-center p-2 hover:bg-white/5 rounded transition-colors group" onclick="os.openApp('video')">
                <i class="ph-duotone ph-play-circle text-2xl text-pink-500 mb-1 group-hover:text-pink-400"></i>
                <span class="text-[10px] text-gray-400 group-hover:text-white">Video</span>
            </button>
            <!-- Added Warning Button -->
            <button class="flex flex-col items-center justify-center p-2 hover:bg-white/5 rounded transition-colors group" onclick="os.openApp('warning')">
                <i class="ph-duotone ph-warning text-2xl text-yellow-500 mb-1 group-hover:text-yellow-400"></i>
                <span class="text-[10px] text-gray-400 group-hover:text-white">Notice</span>
            </button>
            <!-- Added AI Diagnostics Button (NEW) -->
            <button class="flex flex-col items-center justify-center p-2 hover:bg-white/5 rounded transition-colors group" onclick="os.openApp('ai-diagnostics')">
                <i class="ph-duotone ph-brain text-2xl text-indigo-400 mb-1 group-hover:text-indigo-300"></i>
                <span class="text-[10px] text-gray-400 group-hover:text-white">AI Diag</span>
            </button>
        </div>
        <button class="w-full py-2 flex items-center gap-2 hover:bg-red-900/20 hover:text-red-400 rounded px-2 transition-colors text-sm text-gray-500">
            <i class="ph-bold ph-power"></i> Shut Down
        </button>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- DATA & CONFIG ---
        const APPS = {
            'learnflix': {
                id: 'learnflix',
                title: 'LearnFlix',
                icon: 'ph-monitor-play',
                color: 'text-red-600',
                width: 1000,
                height: 700,
                content: `
                    <div class="flex flex-col h-full bg-black">
                        <iframe src="https://new-course-5-series-and-learn-esg-edu-flix-quest--piotr61.replit.app/" class="w-full h-full border-0" allowfullscreen allow="autoplay; encrypted-media"></iframe>
                    </div>
                `
            },
            'personaltutor': {
                id: 'personaltutor',
                title: 'Personal Tutor',
                icon: 'ph-chats-circle',
                color: 'text-purple-500',
                width: 1000,
                height: 700,
                content: `
                    <div class="flex flex-col h-full bg-black">
                        <iframe src="https://new-course-2-ai-avatar-personal-tutor-governance-for-a--piotr61.replit.app/" class="w-full h-full border-0" allow="microphone; camera; autoplay; encrypted-media"></iframe>
                    </div>
                `
            },
            'interactivepodcast': {
                id: 'interactivepodcast',
                title: 'Interactive Podcast',
                icon: 'ph-broadcast',
                color: 'text-orange-500',
                width: 1000,
                height: 700,
                content: `
                    <div class="flex flex-col h-full bg-black">
                        <iframe src="https://new-course-4-podcast-stablecoins--piotr61.replit.app" class="w-full h-full border-0" allow="microphone; autoplay; encrypted-media"></iframe>
                    </div>
                `
            },
            'dailymessenger': {
                id: 'dailymessenger',
                title: 'Daily Messenger',
                icon: 'ph-chat-centered-text',
                color: 'text-teal-500',
                width: '80%',
                height: 700,
                content: `
                    <div class="flex flex-col h-full bg-black">
                        <iframe src="https://new-course-3-daily-messenger-daily-learn-canvas--piotr61.replit.app" class="w-full h-full border-0" allow="microphone; camera; autoplay; encrypted-media"></iframe>
                    </div>
                `
            },
            'experiential': {
                id: 'experiential',
                title: 'Experiential Learning',
                icon: 'ph-flask',
                color: 'text-blue-500',
                width: 1000,
                height: 700,
                content: `
                    <div class="flex flex-col h-full bg-black">
                        <iframe src="https://fintech-challenge--piotr61.replit.app/" class="w-full h-full border-0" allowfullscreen></iframe>
                    </div>
                `
            },
            'video': {
                id: 'video',
                title: 'Welcome Video',
                icon: 'ph-play-circle',
                color: 'text-pink-500',
                width: 800,
                height: 500,
                content: `
                    <div class="relative w-full h-full bg-black group overflow-hidden select-none">
                        <!-- Video Element -->
                        <video id="vid-player" class="w-full h-full object-contain" ontimeupdate="os.updateVideoProgress()" onended="os.resetVideoState()">
                            <source src="https://courses.cfte.education/wp-content/uploads/2025/12/welcome-to-cfte-welcome-to-finance-20.mp4" type="video/mp4">
                        </video>
                        
                        <!-- Central Play Overlay -->
                        <div id="vid-overlay" class="absolute inset-0 flex items-center justify-center bg-black/60 cursor-pointer transition-all duration-300" onclick="os.toggleVideo()">
                            <div class="relative group/btn">
                                <div class="absolute inset-0 bg-cfte-pink blur-xl opacity-20 group-hover/btn:opacity-40 transition-opacity"></div>
                                <div class="w-20 h-20 rounded-full border border-cfte-pink/50 flex items-center justify-center bg-cfte-pink/10 backdrop-blur-sm relative z-10 group-hover/btn:scale-110 transition-transform duration-300 shadow-[0_0_15px_rgba(230,0,126,0.2)]">
                                    <i id="vid-main-icon" class="ph-fill ph-play text-4xl text-cfte-pink ml-1"></i>
                                </div>
                                <!-- Spinning Ring -->
                                <div class="absolute inset-[-4px] border border-cfte-pink/30 rounded-full border-t-transparent animate-spin duration-[3s]"></div>
                            </div>
                        </div>

                        <!-- HUD Controls (Bottom) -->
                        <div class="absolute bottom-0 left-0 w-full p-6 bg-gradient-to-t from-black via-black/80 to-transparent translate-y-4 opacity-0 group-hover:translate-y-0 group-hover:opacity-100 transition-all duration-300">
                            
                            <!-- Progress Bar -->
                            <div class="w-full h-1 bg-white/10 rounded-full mb-4 cursor-pointer relative group/bar hover:h-1.5 transition-all" onclick="os.seekVideo(event)">
                                <div id="vid-progress" class="h-full bg-cfte-pink w-0 relative shadow-[0_0_10px_#E6007E] rounded-full">
                                    <div class="absolute right-0 top-1/2 -translate-y-1/2 w-3 h-3 bg-white rounded-full scale-0 group-hover/bar:scale-100 shadow-lg transition-transform"></div>
                                </div>
                            </div>

                            <div class="flex justify-between items-center text-white">
                                <div class="flex items-center gap-4">
                                    <button onclick="os.toggleVideo()" class="hover:text-cfte-pink transition-colors"><i id="vid-btn-icon" class="ph-bold ph-play text-xl"></i></button>
                                    <span id="vid-time" class="text-xs font-mono text-cfte-pink/80 tracking-wider">00:00 <span class="text-gray-600">/</span> 00:00</span>
                                </div>
                                <div class="flex items-center gap-3">
                                     <i class="ph-bold ph-speaker-high text-gray-400"></i>
                                     <div class="w-16 h-1 bg-gray-700 rounded-full overflow-hidden">
                                         <div class="w-3/4 h-full bg-white/50"></div>
                                     </div>
                                     <button class="ml-2 hover:text-white text-gray-400" onclick="document.getElementById('vid-player').requestFullscreen()"><i class="ph-bold ph-corners-out"></i></button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Decorative Futuristic Corners -->
                        <div class="absolute top-4 left-4 w-16 h-16 border-t border-l border-cfte-pink/50 rounded-tl-lg pointer-events-none"></div>
                        <div class="absolute top-4 right-4 w-16 h-16 border-t border-r border-cfte-pink/50 rounded-tr-lg pointer-events-none"></div>
                        <div class="absolute bottom-4 left-4 w-16 h-16 border-b border-l border-cfte-pink/50 rounded-bl-lg pointer-events-none opacity-0 group-hover:opacity-100 transition-opacity"></div>
                        <div class="absolute bottom-4 right-4 w-16 h-16 border-b border-r border-cfte-pink/50 rounded-br-lg pointer-events-none opacity-0 group-hover:opacity-100 transition-opacity"></div>
                        
                        <!-- Tech Lines -->
                        <div class="absolute top-1/2 left-4 h-12 w-px bg-gradient-to-b from-transparent via-cfte-pink/30 to-transparent pointer-events-none"></div>
                        <div class="absolute top-1/2 right-4 h-12 w-px bg-gradient-to-b from-transparent via-cfte-pink/30 to-transparent pointer-events-none"></div>
                    </div>
                `
            },
            'warning': {
                id: 'warning',
                title: 'System Warning',
                icon: 'ph-warning',
                color: 'text-yellow-500',
                width: 450,
                height: 320,
                content: `
                    <div class="h-full bg-black flex flex-col items-center justify-center text-center p-8 border border-yellow-500/20 relative overflow-hidden">
                         <div class="absolute -top-10 -right-10 w-32 h-32 bg-yellow-500/10 rounded-full blur-3xl"></div>
                         
                        <div class="w-16 h-16 rounded-full bg-yellow-500/10 flex items-center justify-center mb-6 animate-pulse border border-yellow-500/30">
                            <i class="ph-fill ph-warning text-4xl text-yellow-500"></i>
                        </div>
                        
                        <h2 class="text-lg font-bold text-white mb-1 uppercase tracking-widest">Internal Demo App</h2>
                        
                        <div class="w-12 h-1 bg-yellow-500/50 rounded-full mb-6"></div>

                        <div class="space-y-3 text-sm">
                            <p class="text-red-400 font-semibold bg-red-900/10 py-2 px-4 rounded border border-red-500/20">
                                <i class="ph-bold ph-prohibit"></i> NOT SUITABLE FOR PUBLIC DEMONSTRATION
                            </p>
                            <p class="text-gray-400">Please contact <strong class="text-white">Chau</strong> to learn more.</p>
                        </div>

                        <div class="mt-8 text-xs font-mono text-gray-600 border-t border-white/5 pt-4 w-full">
                            DEC 2025 â€¢ SYSTEM BUILD 1.0
                        </div>
                    </div>
                `
            },
            'future': {
                id: 'future',
                title: 'About this App',
                icon: 'ph-lightbulb',
                color: 'text-cyan-500',
                width: 500,
                height: 350,
                content: `
                    <div class="h-full bg-gradient-to-br from-black to-gray-900 p-8 flex flex-col items-center justify-center text-center relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-full h-full pointer-events-none">
                            <div class="absolute top-10 right-10 w-32 h-32 bg-cyan-500/5 rounded-full blur-3xl"></div>
                            <div class="absolute bottom-10 left-10 w-32 h-32 bg-purple-500/5 rounded-full blur-3xl"></div>
                        </div>
                        <img src="https://courses.cfte.education/wp-content/uploads/2024/09/act-cfte-logo-transparent-white-e1737471820731.png" class="w-32 mb-6 opacity-90" alt="CFTE Logo">
                        <h2 class="text-2xl font-bold mb-4 text-white">The Future is Here</h2>
                        <p class="text-gray-400 leading-relaxed text-sm">
                            Experience a glimpse into the future of education. This demo explores how technology is redefining the learning process, empowering users to engage with knowledge through innovative and personalized methods.
                        </p>
                    </div>
                `
            },
            'terminal': {
                id: 'terminal',
                title: 'Terminal',
                icon: 'ph-terminal-window',
                color: 'text-green-500',
                width: 600,
                height: 400,
                content: `
                    <div class="h-full bg-[#050505] font-mono text-sm p-2 flex flex-col" onclick="document.getElementById('term-input').focus()">
                        <div id="term-output" class="flex-1 overflow-y-auto text-gray-300 space-y-1">
                            <div class="text-green-500">Welcome to CFTE OS v1.0.0</div>
                            <div class="text-gray-600">Type 'help' for available commands.</div>
                            <br>
                        </div>
                        <div class="flex items-center gap-2 mt-2">
                            <span class="text-cfte-pink">user@cfte:~$</span>
                            <input type="text" id="term-input" class="bg-transparent border-none focus:outline-none flex-1 text-white" autocomplete="off" onkeydown="os.handleTerminal(event)">
                        </div>
                    </div>
                `
            },
            'about': {
                id: 'about',
                title: 'About CFTE',
                icon: 'ph-info',
                color: 'text-gray-400',
                width: 500,
                height: 350,
                content: `
                    <div class="h-full bg-gradient-to-br from-black to-gray-900 p-8 text-center flex flex-col items-center justify-center">
                        <img src="https://courses.cfte.education/wp-content/uploads/2024/09/act-cfte-logo-transparent-white-e1737471820731.png" class="w-32 mb-6 opacity-90" alt="CFTE Logo">
                        <h2 class="text-2xl font-bold mb-2">CFTE OS <span class="text-xs align-top opacity-60">v1.0</span></h2>
                        <p class="text-gray-500 text-sm mb-6">Centre for Finance, Technology and Entrepreneurship.<br>We help people and organizations create the future of finance.</p>
                        <div class="flex gap-4">
                            <button class="bg-cfte-pink hover:bg-pink-700 px-4 py-2 rounded text-sm transition-colors text-white" onclick="window.open('https://courses.cfte.education', '_blank')">Visit Website</button>
                        </div>
                    </div>
                `
            },
            'ai-diagnostics': { // NEW APP
                id: 'ai-diagnostics',
                title: 'AI Diagnostics',
                icon: 'ph-brain',
                color: 'text-indigo-400',
                width: 1100,
                height: 750,
                content: `
                    <div class="flex flex-col h-full bg-black">
                        <iframe src="https://diag.cfte.education/" class="w-full h-full border-0" allowfullscreen></iframe>
                    </div>
                `
            }
        };

        // --- CORE OS LOGIC ---
        class OperatingSystem {
            constructor() {
                this.zIndex = 100;
                this.activeWindows = {};
                this.isDragging = false;
                this.dragOffset = { x: 0, y: 0 };
                this.currentDragWindow = null;
                
                this.initDesktop();
                this.initClock();
                this.initEventListeners();
            }

            initDesktop() {
                const desktop = document.getElementById('desktop');
                Object.values(APPS).forEach(app => {
                    const iconEl = document.createElement('div');
                    iconEl.className = 'app-icon flex flex-col items-center gap-2 cursor-pointer w-24 p-2 rounded hover:bg-white/5 transition-all group';
                    iconEl.onclick = () => this.openApp(app.id);
                    iconEl.innerHTML = `
                        <div class="w-12 h-12 glass rounded-xl flex items-center justify-center text-3xl ${app.color} shadow-lg group-hover:shadow-cfte-pink/20 transition-all bg-[#121212]">
                            <i class="ph-duotone ${app.icon}"></i>
                        </div>
                        <span class="text-xs text-gray-400 font-medium text-center shadow-black drop-shadow-md group-hover:text-white">${app.title}</span>
                    `;
                    desktop.appendChild(iconEl);
                });
            }

            initClock() {
                const update = () => {
                    const now = new Date();
                    document.getElementById('clock-time').textContent = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                    document.getElementById('clock-date').textContent = now.toLocaleDateString([], { month: 'short', day: 'numeric' });
                };
                setInterval(update, 1000);
                update();
            }

            initEventListeners() {
                // Start Menu Toggle
                const startBtn = document.getElementById('start-btn');
                const startMenu = document.getElementById('start-menu');
                startBtn.onclick = (e) => {
                    e.stopPropagation();
                    startMenu.classList.toggle('hidden');
                };
                document.onclick = (e) => {
                    if (!startMenu.contains(e.target) && !startBtn.contains(e.target)) {
                        startMenu.classList.add('hidden');
                    }
                };

                // Global Mouse Move for Dragging
                document.addEventListener('mousemove', (e) => {
                    if (!this.isDragging || !this.currentDragWindow) return;
                    e.preventDefault();
                    const x = e.clientX - this.dragOffset.x;
                    const y = e.clientY - this.dragOffset.y;
                    this.currentDragWindow.style.left = `${x}px`;
                    this.currentDragWindow.style.top = `${y}px`;
                });

                document.addEventListener('mouseup', () => {
                    this.isDragging = false;
                    if(this.currentDragWindow) {
                        this.currentDragWindow.classList.remove('opacity-90');
                        this.currentDragWindow = null;
                    }
                });
            }

            openApp(appId) {
                // Close Start Menu
                document.getElementById('start-menu').classList.add('hidden');

                if (this.activeWindows[appId]) {
                    this.focusWindow(appId);
                    return;
                }

                const app = APPS[appId];
                const winId = `win-${appId}`;
                const taskId = `task-${appId}`;

                // Create Window
                const win = document.createElement('div');
                win.id = winId;
                win.className = `absolute glass rounded-lg overflow-hidden flex flex-col text-cfte-text shadow-2xl animate-pop-in pointer-events-auto bg-[#121212]`;
                
                // Handle percentage or pixel widths
                win.style.width = typeof app.width === 'number' ? `${app.width}px` : app.width;
                win.style.height = typeof app.height === 'number' ? `${app.height}px` : app.height;
                
                win.style.minWidth = '300px';
                win.style.minHeight = '200px';
                
                // Center Window randomly slightly
                const randX = 50 + Math.random() * 50;
                const randY = 50 + Math.random() * 50;
                win.style.top = `${randY}px`;
                win.style.left = `${randX}px`;
                win.style.zIndex = ++this.zIndex;

                // Window Header
                win.innerHTML = `
                    <div class="window-header bg-[#000000]/40 p-2 flex justify-between items-center cursor-move select-none border-b border-cfte-border backdrop-blur-sm" 
                         onmousedown="os.startDrag(event, '${winId}')">
                        <div class="flex items-center gap-2 pl-2">
                            <i class="ph-bold ${app.icon} ${app.color}"></i>
                            <span class="text-xs font-medium text-gray-300">${app.title}</span>
                        </div>
                        <div class="flex items-center gap-1">
                            <button class="p-1 hover:bg-white/10 rounded text-gray-500 hover:text-white transition-colors" onclick="os.minimizeWindow('${appId}')"><i class="ph-bold ph-minus"></i></button>
                            <button class="p-1 hover:bg-red-900/50 hover:text-white rounded text-gray-500 transition-colors" onclick="os.closeApp('${appId}')"><i class="ph-bold ph-x"></i></button>
                        </div>
                    </div>
                    <div class="flex-1 overflow-hidden relative">
                        ${app.content}
                    </div>
                    <!-- Resize Handle -->
                    <div class="absolute bottom-0 right-0 w-4 h-4 cursor-se-resize z-20 opacity-0 hover:opacity-100 bg-white/10 rounded-tl"></div>
                `;

                win.style.resize = 'both';
                win.onmousedown = () => this.focusWindow(appId);

                document.getElementById('window-container').appendChild(win);
                this.activeWindows[appId] = win;

                // Create Taskbar Item
                const taskItem = document.createElement('div');
                taskItem.id = taskId;
                taskItem.className = `h-8 w-8 md:w-auto md:px-3 flex items-center justify-center gap-2 bg-white/5 rounded cursor-pointer hover:bg-white/10 transition-colors border-b-2 border-cfte-pink`;
                taskItem.innerHTML = `
                    <i class="ph-bold ${app.icon} ${app.color}"></i>
                    <span class="hidden md:inline text-xs truncate max-w-[80px] text-gray-300">${app.title}</span>
                `;
                taskItem.onclick = () => {
                    if (win.style.display === 'none') {
                        win.style.display = 'flex';
                        this.focusWindow(appId);
                    } else if (parseInt(win.style.zIndex) === this.zIndex) {
                        this.minimizeWindow(appId);
                    } else {
                        this.focusWindow(appId);
                    }
                };
                document.getElementById('taskbar-apps').appendChild(taskItem);
            }

            closeApp(appId) {
                const win = document.getElementById(`win-${appId}`);
                const task = document.getElementById(`task-${appId}`);
                
                if (win) win.remove();
                if (task) task.remove();
                
                delete this.activeWindows[appId];
            }

            minimizeWindow(appId) {
                const win = document.getElementById(`win-${appId}`);
                const task = document.getElementById(`task-${appId}`);
                if (win) {
                    win.style.display = 'none';
                    task.classList.remove('bg-white/5', 'border-cfte-pink');
                    task.classList.add('opacity-40', 'border-transparent');
                }
            }

            focusWindow(appId) {
                const win = document.getElementById(`win-${appId}`);
                const task = document.getElementById(`task-${appId}`);
                if (win) {
                    win.style.display = 'flex';
                    win.style.zIndex = ++this.zIndex;
                    
                    // Taskbar active state
                    document.querySelectorAll('#taskbar-apps > div').forEach(el => {
                        el.classList.remove('bg-white/5', 'border-cfte-pink');
                        el.classList.add('border-transparent');
                        el.classList.add('opacity-40');
                    });
                    task.classList.remove('opacity-40', 'border-transparent');
                    task.classList.add('bg-white/5', 'border-cfte-pink');
                }
            }

            startDrag(e, winId) {
                if (e.target.closest('button') || e.target.closest('.cursor-pointer')) return; // Allow interaction with video controls

                this.isDragging = true;
                this.currentDragWindow = document.getElementById(winId);
                
                const rect = this.currentDragWindow.getBoundingClientRect();
                this.dragOffset.x = e.clientX - rect.left;
                this.dragOffset.y = e.clientY - rect.top;
                
                this.currentDragWindow.classList.add('opacity-90');
            }

            // --- VIDEO PLAYER LOGIC ---
            toggleVideo() {
                const video = document.getElementById('vid-player');
                const overlay = document.getElementById('vid-overlay');
                const mainIcon = document.getElementById('vid-main-icon');
                const btnIcon = document.getElementById('vid-btn-icon');
                
                if (!video) return;

                if (video.paused) {
                    video.play();
                    overlay.classList.add('opacity-0', 'pointer-events-none');
                    mainIcon.classList.replace('ph-play', 'ph-pause');
                    btnIcon.classList.replace('ph-play', 'ph-pause');
                } else {
                    video.pause();
                    overlay.classList.remove('opacity-0', 'pointer-events-none');
                    mainIcon.classList.replace('ph-pause', 'ph-play');
                    btnIcon.classList.replace('ph-pause', 'ph-play');
                }
            }

            updateVideoProgress() {
                const video = document.getElementById('vid-player');
                if (!video) return;

                const percent = (video.currentTime / video.duration) * 100;
                document.getElementById('vid-progress').style.width = `${percent}%`;

                // Format Time
                const format = (s) => {
                    const m = Math.floor(s / 60);
                    const sec = Math.floor(s % 60);
                    return `${m.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
                };
                
                document.getElementById('vid-time').innerHTML = 
                    `${format(video.currentTime)} <span class="text-gray-600">/</span> ${format(video.duration || 0)}`;
            }

            seekVideo(e) {
                const video = document.getElementById('vid-player');
                const bar = e.currentTarget;
                if (!video || !bar) return;

                const rect = bar.getBoundingClientRect();
                const pos = (e.clientX - rect.left) / rect.width;
                video.currentTime = pos * video.duration;
            }

            resetVideoState() {
                const overlay = document.getElementById('vid-overlay');
                const mainIcon = document.getElementById('vid-main-icon');
                const btnIcon = document.getElementById('vid-btn-icon');
                
                overlay.classList.remove('opacity-0', 'pointer-events-none');
                mainIcon.classList.replace('ph-pause', 'ph-play');
                btnIcon.classList.replace('ph-pause', 'ph-play');
                document.getElementById('vid-progress').style.width = '0%';
            }

            handleTerminal(e) {
                if (e.key === 'Enter') {
                    const input = document.getElementById('term-input');
                    const output = document.getElementById('term-output');
                    const cmd = input.value.trim().toLowerCase();
                    
                    const writeLine = (text, color = 'text-gray-400') => {
                        output.innerHTML += `<div class="${color}">${text}</div>`;
                    };

                    writeLine(`user@cfte:~$ ${cmd}`, 'text-gray-500');

                    switch(cmd) {
                        case 'help':
                            writeLine('Available commands: help, date, clear, whoami, courses, exit');
                            break;
                        case 'date':
                            writeLine(new Date().toString());
                            break;
                        case 'clear':
                            output.innerHTML = '';
                            break;
                        case 'whoami':
                            writeLine('guest_user (Fintech Enthusiast)', 'text-cfte-pink');
                            break;
                        case 'courses':
                            writeLine('Fetching course list...', 'text-blue-500');
                            writeLine('- AI in Finance');
                            writeLine('- Fintech 360');
                            writeLine('- Blockchain & Digital Assets');
                            break;
                        case 'exit':
                            this.closeApp('terminal');
                            break;
                        default:
                            writeLine(`Command not found: ${cmd}`, 'text-red-500');
                    }

                    input.value = '';
                    output.scrollTop = output.scrollHeight;
                }
            }
        }

        // Initialize OS
        const os = new OperatingSystem();
        
        // Open welcome app & warning app
        setTimeout(() => {
            os.openApp('future');
            // Slight delay for warning to appear on top
            setTimeout(() => os.openApp('warning'), 200);
        }, 500);

    </script>
</body>
</html>
